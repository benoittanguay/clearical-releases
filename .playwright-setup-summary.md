# Playwright Setup Summary for TimePortal

## Installation Complete

Playwright has been successfully configured for testing your Electron application.

## What Was Installed

### Dependencies
- `@playwright/test` v1.57.0 - Playwright test framework
- `playwright` v1.57.0 - Playwright browser automation

### Files Created

#### Configuration Files
1. **playwright.config.ts** - Main Playwright configuration
   - Configured for Electron testing
   - Single worker (tests run sequentially)
   - Screenshot/video on failure
   - HTML reporter with GitHub Actions support

2. **tests/tsconfig.json** - TypeScript configuration for tests
   - Extends base config
   - Includes Playwright types

#### Test Infrastructure
3. **tests/helpers/electron.ts** - Comprehensive utility functions
   - App lifecycle: launch, close, wait for ready
   - Window management: get info, wait for windows
   - IPC testing: invoke, mock handlers, wait for events
   - Debugging: console logs, screenshots, app info

4. **tests/fixtures/electron.ts** - Playwright fixtures
   - Auto-setup and teardown of Electron app
   - Provides `electronApp` and `window` fixtures
   - Configurable launch options

#### Test Files
5. **tests/e2e/app.spec.ts** - Basic app tests
   - Launch verification
   - Title and root element checks
   - App mode and version validation
   - Console error detection
   - Window resize handling
   - Screenshot capabilities

6. **tests/e2e/timer.spec.ts** - TimePortal-specific tests
   - Timer interface tests
   - UI accessibility checks
   - Data management tests
   - System integration tests
   - Screenshot functionality
   - Performance benchmarks

#### Documentation
7. **tests/README.md** - Detailed testing guide
   - Directory structure
   - Getting started
   - Writing tests
   - Helper functions reference
   - Best practices
   - Troubleshooting

8. **TESTING.md** - Quick start guide
   - Running tests
   - Common patterns
   - Available helpers
   - Tips and tricks
   - CI/CD integration

## NPM Scripts Added

```json
"test": "npm run build:electron-main && playwright test",
"test:headed": "npm run build:electron-main && playwright test --headed",
"test:debug": "npm run build:electron-main && playwright test --debug",
"test:report": "playwright show-report test-results/html"
```

## Directory Structure Created

```
tests/
├── e2e/                      # End-to-end tests
│   ├── app.spec.ts          # Basic app tests
│   └── timer.spec.ts        # Timer-specific tests
├── unit/                     # Unit tests (empty, ready for use)
├── fixtures/                 # Test fixtures
│   └── electron.ts          # Electron app fixtures
├── helpers/                  # Test utilities
│   └── electron.ts          # Helper functions
├── tsconfig.json            # TypeScript config
└── README.md                # Testing guide
```

## .gitignore Updated

Added test artifacts to .gitignore:
- test-results/
- playwright-report/
- playwright/.cache/

## How to Use

### Run Tests
```bash
# Run all tests (headless)
npm test

# Run with visible window
npm run test:headed

# Debug tests with Playwright Inspector
npm run test:debug

# View test report
npm run test:report
```

### Run Specific Tests
```bash
# Run single file
npx playwright test tests/e2e/app.spec.ts

# Run tests matching pattern
npx playwright test --grep "should launch"

# Run in specific browser (if configured)
npx playwright test --project=electron
```

### Write New Tests
```typescript
import { test, expect } from '../fixtures/electron';

test('my test', async ({ electronApp, window }) => {
  // Your test code
  const title = await window.title();
  expect(title).toBeTruthy();
});
```

## Key Features

### 1. Automatic App Management
Tests automatically launch and close the Electron app:
```typescript
test('auto-managed', async ({ window }) => {
  // App is already launched and ready
  await expect(window.locator('#root')).toBeVisible();
  // App will be closed automatically after test
});
```

### 2. Rich Helper Functions
Access 20+ helper functions:
```typescript
import {
  launchElectronApp,
  invokeIPC,
  waitForConsoleMessage,
  getAppVersion
} from '../helpers/electron';
```

### 3. IPC Testing Support
Test main-renderer communication:
```typescript
import { invokeIPC } from '../helpers/electron';

test('IPC test', async ({ window }) => {
  const result = await invokeIPC(window, 'my-channel', 'arg1');
  expect(result).toBeDefined();
});
```

### 4. Debug-Friendly
- Headed mode to watch tests run
- Playwright Inspector for step-by-step debugging
- Console log capture
- Screenshots and videos on failure

### 5. CI-Ready
- Configured for GitHub Actions
- Automatic retries on failure
- Artifact collection
- Multiple reporters

## Next Steps

1. **Customize Tests**: Update the example tests to match your actual UI
2. **Add IPC Tests**: Test your specific IPC channels
3. **Add Visual Tests**: Use Playwright's screenshot comparison
4. **Set Up CI**: Add tests to your GitHub Actions workflow
5. **Add Coverage**: Configure code coverage reporting

## Example CI Configuration

```yaml
name: Tests
on: [push, pull_request]

jobs:
  test:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
      - run: npm ci
      - run: npm run build:electron-main
      - run: npm test
      - uses: actions/upload-artifact@v3
        if: always()
        with:
          name: test-results
          path: test-results/
```

## Customization Points

### Launch Options
Customize in test files:
```typescript
test.use({
  launchOptions: {
    env: { TEST_MODE: 'true' },
    timeout: 60000,
    recordVideo: true,
  },
});
```

### Playwright Config
Edit `playwright.config.ts` to:
- Change timeout values
- Add more projects
- Configure different reporters
- Enable/disable video recording

### Helper Functions
Add your own helpers to `tests/helpers/electron.ts`

## Troubleshooting

### "Cannot find module" Error
```bash
npm run build:electron-main
```

### Tests Timeout
Increase timeout in `playwright.config.ts` or specific tests:
```typescript
test.setTimeout(60000); // 60 seconds
```

### App Won't Launch
1. Check `dist-electron/main.js` exists
2. Kill any running Electron instances
3. Run in headed mode to see errors: `npm run test:headed`

## Resources

- [Playwright Docs](https://playwright.dev/)
- [Playwright Electron API](https://playwright.dev/docs/api/class-electron)
- [tests/README.md](./tests/README.md) - Detailed guide
- [TESTING.md](./TESTING.md) - Quick start

## Support Contacts

For issues:
1. Check the documentation in `tests/README.md`
2. Review example tests
3. Use debug mode: `npm run test:debug`
4. Check Playwright docs

---

**Setup completed successfully!**
Run `npm test` to verify everything works.
